= Configuration
:toc:

We have three categories of configuration:

[%autowidth]
|===
| Category | File(s) | xref:workspace-structure.adoc[Workspace Structure] `:configs` key(s)

a| `poly` workspace
a| `workspace.edn`
a| `:workspace`

a| xref:tools-deps.adoc[tools.deps]
a| `deps.edn` files in projects and bricks
a| `:projects` `:bases` `:components`

a|`poly` user
a| `~/.config/polylith/config.edn`
a| `:user`

|===

NOTE: If you are following along from our `example` workspace xref:introduction.adoc[tutorial], you might notice some output does not exactly match what we show here.
In some cases, we added a bit of config just to show what it would look like.

== Poly `workspace.edn`

An initial `workspace.edn` is automatically generated when you xref:workspace.adoc[create a workspace].
You make changes by editing the `workspace.edn` file directly.

You can list workspace configs with the xref:commands.adoc#ws[ws] command:

[source,shell]
----
poly ws get:configs:workspace
----

[source,clojure]
----
{:bricks {"user-remote" {:keep-lib-versions [ring/ring slacker/slacker]}}
 :compact-views #{},
 :default-profile-name "default",
 :interface-ns "interface",
 :projects {"command-line" {:alias "cl",
                            :test {:setup-fn project.command-line.test-setup/setup,
                                   :teardown-fn project.command-line.test-setup/teardown}},
            "development" {:alias "dev"},
            "user-service" {:alias "user-s"}},
 :tag-patterns {:release "v[0-9]*", :stable "stable-*"},
 :top-namespace "se.example",
 :vcs {:auto-add true, :name "git"}}
----

The workspace map keys are:

[%autowidth]
|===
| Key | Description

a| `:bricks`
a| Brick-specific configuration where the map key is the brick name.
Specify `:keep-lib-versions` to tell `libs :update` to xref:libraries.adoc#keep-lib-versions[skip specified libraries]. +
*Default:* absent, effectively `{}`

a| `:compact-view`
a| Can tell `poly` to use a compact format for xref:commands.adoc#deps[deps] command xref:dependencies.adoc#compact-view[output] and xref:commands.adoc#libs[libs] command xref:libraries.adoc#compact-view[output].
For example, to turn compact format on for both `deps` and `libs`, set to `+#{"deps" "libs"}+`. +
*Default:* `+#{}+`

a| [nowrap]`:default-profile-name`
a| The name of the profile that `poly` automatically merges into the xref:development.adoc[development] project when using xref:profile.adoc[profiles], and no profile is specified. +
*Default:* `"default"`

a| `:interface-ns`
a| Tells `poly` when to consider a namespace an interface and what naming convention the xref:commands.adoc#create-component[create component] command should use.
See xref:interface.adoc#interface-ns[Interface] for important details. +
*Default:* `"interface"`

a| `:projects`
a| See xref:#ws-projects[projects] below. +
*Default:* see below

a| `:tag-patterns`
a| Specifies the https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html[regex] patterns used when searching for the most recent tag in git.
As explained in xref:tagging.adoc[Tagging], `poly` uses this pattern to calculate the latest committed sha that is considered the _latest stable point in time_. +
*Default:* `+{:stable "stable-*" :release "v[0-9]*"}+`

a| `:test`
a| See xref:test-runners.adoc#test-configuration[Test configuration].

a| `:top-namespace`
a| The top namespace used throughout the workspace in components and bases, specified by you when you create your xref:workspace.adoc[workspace]. +
*Default:* none, must be specified

a| `:vcs`
a| A map with two keys describing your https://en.wikipedia.org/wiki/Version_control[version control system]:

* `:name` at this time, always `"git"`
* `:auto-add` a boolean, when `true`, tells `poly` to automatically add directories and files to git that are generated by the xref:commands#create[create] command. +

*Default:* `{:name "git" :auto-add false}`
|===

[#ws-projects]
=== Projects

You configure individual xref:project.adoc[projects] under the `:projects` key.
You can retrieve projects config via:

[source,shell]
----
poly ws get:configs:workspace:projects
----

[source,clojure]
----
{"command-line" {:alias "cl",
                 :test {:setup-fn project.command-line.test-setup/setup,
                        :teardown-fn project.command-line.test-setup/teardown}},
 "development" {:alias "dev"},
 "user-service" {:alias "user-s"
                 :test {:exclude ["mybrick"]}
                 :keep-lib-versions [org.slf4j/slf4j-nop]
                 :necessary ["helper"]}}
----

The keys are the full project names.

The default alias for the `development` project is created for you when your xref:workspace.adoc[create your workspace].
Deployable projects get no automatically generated config under `:projects`.

Project map keys are:

[%autowidth]
|===
| Key | Description

a| `:alias`
a| Specifies a short name for a project.
You can use the alias instead of the full project name for various `poly` commands.
If not specified, the xref:commands.adoc#info[info] and xref:commands.adoc[libs] commands emit a `?` followed by a number (e.g. `?1`) for project column headings.

a| [nowrap]`:keep-lib-versions`
a| Tells `libs :update` to xref:libraries.adoc#keep-lib-versions[skip specified libraries] for the project.

a| [nowrap]`:necessary`
a| Supports turning off `Warning 207` for one or more bricks.
See xref:validations.adoc#warning207[Validations].

a| `:test`
a| See next table below.

|===

You specify xref:testing.adoc[test] configuration under the `:test` key for a specific project:

[%autowidth]
|===
| Key | Description

a| `:exclude`
a| Lists the bricks to exclude when running tests for the project.
^xref:#include-exclude[1]^


a| `:include`
a| Lists the bricks to include when running tests for the project.
^xref:#include-exclude[1]^

a| `:setup-fn`
a| The function name (including namespace) to call before `poly` runs tests.
^xref:#setup-teardown[2]^


a| [nowrap]`:teardown-fn`
a| The function name (including namespace) to call after `poly` runs tests.
^xref:#setup-teardown[2]^

|===

Table notes:

. [[include-exclude]] See xref:testing.adoc#include-exclude[Include and Exclude Bricks by Configuration].
. [[setup-teardown]] See xref:testing#setup-and-teardown[Test Setup and Teardown].


== Tools.deps `deps.edn` Files

The various `poly create` commands create initial `deps.edn` files.
You make changes via manual edits or the xref:libraries#update[libs :update] command.

=== Projects

Each xref:project.adoc[project] has its own `deps.edn` configuration file.

You'll find:

* The xref:development.adoc[development] project config in `./deps.edn`.
The xref:commands.adoc#create-workspace[create workspace] command creates the initial file.
* Deployable xref:project.adoc[projects] are configured in `projects/_PROJECT-DIR_/deps.edn` where `_PROJECT-DIR_` is the deployable project's directory (and name).
The xref:commands.adoc#create-project[create project] command creates the initial file.

You can retrieve a project's tools.deps config via, e.g.:

[source,shell]
----
poly ws get:configs:projects:command-line
----

[source,clojure]
----
{:deps {:aliases {:test {:extra-deps {}, :extra-paths ["test"]},
                  :uberjar {:main se.example.cli.core}},
        :deps {org.apache.logging.log4j/log4j-core {:mvn/version "2.13.3"},
               org.apache.logging.log4j/log4j-slf4j-impl {:mvn/version "2.13.3"},
               org.clojure/clojure {:mvn/version "1.12.0"},
               poly/cli {:local/root "../../bases/cli"},
               poly/user-remote {:local/root "../../components/user-remote"}}},
 :name "command-line",
 :type "project"}
----

[%autowidth]
|===
| Key | Description

a| `:deps`
a| Content of project `deps.edn`

a| `:name`
a| (derived) The project name

a| `:type`
a| (derived) Always `"project"` for projects
|===

=== Bases

Each xref:base.adoc[base] tools.deps config is found in `bases/_BASE-DIR_/deps.edn` where `_BASE-DIR_` is the base's directory (and name).
The xref:commands.adoc#create-base[create base] command creates the initial file.

You can retrieve a base's tools.deps config via, e.g.:

[source,shell]
----
poly ws get:configs:bases:cli
----

[source,clojure]
----
{:deps {:aliases {:test {:extra-deps {}, :extra-paths ["test"]}},
        :deps {},
        :paths ["src" "resources"]},
 :name "cli",
 :type "base"}
----

[%autowidth]
|===
| Key | Description

a| `:deps`
a| Content of base `deps.edn`.

a| `:name`
a| (derived) The base name.

a| `:type`
a| (derived) Always `"base"` for bases.
|===

=== Components

Each xref:component.adoc[component] tools.deps config is found in `components/_COMPONENT-DIR_/deps.edn` where `_COMPONENT-DIR_` is the component's directory (and name).

You can retrieve a component's tools.deps config via, e.g.:

[source,shell]
----
poly ws get:configs:components:user
----

[source,clojure]
----
{:deps {:aliases {:test {:extra-deps {}, :extra-paths ["test"]}},
        :deps {},
        :paths ["src" "resources"]},
 :name "user",
 :type "component"}
----

[%autowidth]
|===
| Key | Description

a| `:deps`
a| The content of `deps.edn`.

a| `:name`
a| (derived) The component name.

a| `:type`
a| (derived) Always `"component"` for components.
|===

[[user]]
== Poly User `config.edn`

You specify your user preferences in `~/.config/polylith/config.edn`.
If it does not already exist, the xref:commands.adoc#create-workspace[create workspace] automatically creates this file for you.

****
If you started using the `poly` tool from version `0.2.14-alpha` or earlier, then the settings may be stored in `~/.polylith/config.edn`:
****

You can retrieve the config via:

[source,shell]
----
poly ws get:configs:user
----

[source,clojure]
----
{:color-mode "dark", :empty-character ".", :thousand-separator ","}
----

[%autowidth]
|===
| Key | Description

a| [[color-mode]] `:color-mode`
a| Valid values are `"none"`, `"light"` and `"dark"`; see the xref:colors.adoc[Colors].
You can override when running `poly` xref:commands.adoc[commands] with e.g.: `poly info color-mode:none`. +
*Default:* `"none"` on Windows, `"dark"` on other operating systems.

a| `:empty-character`
a| The `poly` tool uses this character in output for the xref:commands.adoc#deps[deps] and xref:commands.adoc#libs[libs] commands. +
*Default:* `"."`

a| [nowrap]`:thousand-separator`
a| The thousands separator for `:loc` for the xref:commands.adoc#info[info] command. +
*Default:* `","`

a| `:m2-dir`
a| Tells the xref:commands.adoc#libs[libs] where it can find your local Maven repository, which it uses to calculate library `KB` sizes. +
*Default:* `~/.m2`

[[ws-shortcuts]]
a| `:ws-shortcuts`
a| Contains a map with the keys `:root-dir` and `:paths` which are used by the xref:shell#switch-workspace[switching workspace] functionality in the shell. The `:root-dir` stores the root of the paths specified in `:paths` and is prepended to the paths. Each map in `:paths` has either a `:dir` or `:file` key which specifies a path for a workspace. The name of the directory or file will be used by the `via:NAME` argument, but can be overridden by `:name`.

|===

[[custom]]
== Custom configuration

If you have custom configuration data, then we suggest that you put it in a `:custom` key in `workspace.edn` at the root and/or under each brick/project. If you put your custom data there, it will not collide with future keys introduced by the tool.
